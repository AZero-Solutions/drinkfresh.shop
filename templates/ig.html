<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrinkFresh.shop | Premium King Coconut Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            orange: '#FF8800', 
                            dark: '#1A1A1A',
                            green: '#2F855A',
                            light: '#FFFBF0',
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .hero-gradient { background: radial-gradient(circle at center, #FF8800 0%, #FF5500 100%); }
        .glass-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid #FF8800; width: 20px; height: 20px; -webkit-animation: spin 1s linear infinite; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-brand-light text-brand-dark antialiased">

    <nav class="fixed w-full z-50 glass-nav transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center cursor-pointer" onclick="window.scrollTo(0,0)">
                    <span class="text-3xl font-extrabold tracking-tighter">DRINK<span class="text-brand-orange">FRESH</span></span>
                    <div class="w-2 h-2 bg-brand-green rounded-full ml-1 mb-3"></div>
                </div>
                
                <div class="flex items-center space-x-6">
                    <button onclick="toggleCart()" class="relative group">
                        <div class="p-3 bg-gray-100 rounded-full group-hover:bg-brand-orange group-hover:text-white transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                            </svg>
                        </div>
                        <span id="cart-count" class="absolute -top-1 -right-1 h-5 w-5 text-xs font-bold flex items-center justify-center bg-black text-white rounded-full border-2 border-white">0</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <section class="relative pt-32 pb-20 lg:pt-48 overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
            <div>
                <span class="bg-orange-100 text-brand-orange px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wide mb-4 inline-block">Now Delivering in Colombo</span>
                <h1 class="text-5xl lg:text-7xl font-extrabold mb-6 leading-tight">
                    Pure Hydration.<br>
                    <span class="text-brand-orange">Straight from the Tree.</span>
                </h1>
                <p class="text-xl text-gray-600 mb-8 max-w-lg">
                    Premium King Coconuts harvested at dawn and delivered to your doorstep. Experience the taste of real freshness.
                </p>
                <div class="flex gap-4">
                    <a href="#shop" class="px-8 py-4 bg-brand-dark text-white font-bold rounded-xl hover:bg-brand-orange transition-colors duration-300 shadow-lg">
                        Order Now
                    </a>
                </div>
            </div>
            <div class="relative">
                <div class="absolute top-0 right-0 w-72 h-72 bg-orange-200 rounded-full mix-blend-multiply filter blur-2xl opacity-70 animate-blob"></div>
                <div class="absolute -bottom-8 left-20 w-72 h-72 bg-green-200 rounded-full mix-blend-multiply filter blur-2xl opacity-70 animate-blob animation-delay-2000"></div>
                <img src="/assets/Gemini_Generated_Image_qy4x4hqy4x4hqy4x-removebg-preview.png" alt="Fresh Thambili" class="relative rounded-3xl shadow-2xl transform rotate-2 hover:rotate-0 transition duration-500 border-4 border-white">
            </div>
        </div>
    </section>

    <section id="shop" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold mb-12">Fresh Harvest</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="product-grid">
                </div>
        </div>
    </section>

    <div id="cart-sidebar" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="toggleCart()"></div>
        <div class="absolute inset-y-0 right-0 max-w-full flex">
            <div class="w-screen max-w-md bg-white shadow-2xl flex flex-col h-full transform transition-transform duration-300 translate-x-0">
                
                <div class="flex items-center justify-between p-6 border-b">
                    <h2 class="text-xl font-bold">Your Bag</h2>
                    <button onclick="toggleCart()" class="text-gray-400 hover:text-black">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto p-6">
                    <ul id="cart-items" class="space-y-6">
                        </ul>
                </div>

                <div class="border-t p-6 bg-gray-50">
                    <div class="flex justify-between text-lg font-bold mb-4">
                        <span>Total</span>
                        <span id="cart-total">LKR 0.00</span>
                    </div>
                    <button id="checkout-btn" onclick="checkout()" class="w-full bg-brand-dark text-white py-4 rounded-xl font-bold hover:bg-brand-orange transition-all duration-300 flex justify-center items-center gap-2">
                        <span>Proceed to Pay</span>
                    </button>
                    <p class="text-center text-xs text-gray-400 mt-4 flex items-center justify-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                        Secured by PayHere
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. Product Data
        const products = [
            { id: 1, name: "Premium King Coconut", price: 150, desc: "Whole, trimmed & ready.", img: "https://images.unsplash.com/photo-1620916297397-a4a5402a3c6c?q=80&w=400" },
            { id: 2, name: "Chilled Thambili Bottle", price: 250, desc: "350ml. Cold pressed.", img: "https://images.unsplash.com/photo-1629198688000-71f23e745b6e?q=80&w=400" },
            { id: 3, name: "The 6-Pack Crate", price: 850, desc: "Best value family pack.", img: "https://images.unsplash.com/photo-1596450514930-b3287eb8c393?q=80&w=400" }
        ];

        let cart = [];

        // 2. Render Products
        const grid = document.getElementById('product-grid');
        products.forEach(p => {
            const el = document.createElement('div');
            el.className = "bg-white border rounded-2xl overflow-hidden hover:shadow-xl transition-all duration-300 group";
            el.innerHTML = `
                <div class="h-64 overflow-hidden bg-gray-100">
                    <img src="${p.img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                </div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg">${p.name}</h3>
                        <span class="font-bold text-brand-orange">LKR ${p.price}</span>
                    </div>
                    <p class="text-sm text-gray-500 mb-4">${p.desc}</p>
                    <button onclick="addToCart(${p.id})" class="w-full py-3 rounded-lg border-2 border-brand-dark hover:bg-brand-dark hover:text-white font-semibold transition-colors">Add to Cart</button>
                </div>
            `;
            grid.appendChild(el);
        });

        // 3. Cart Logic
        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            sidebar.classList.toggle('hidden');
        }

        function addToCart(id) {
            const item = products.find(p => p.id === id);
            cart.push(item);
            renderCart();
            document.getElementById('cart-sidebar').classList.remove('hidden');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            renderCart();
        }

        function renderCart() {
            const list = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            
            list.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                list.innerHTML = '<div class="text-center py-10 text-gray-400">Your cart is empty.</div>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price;
                    list.innerHTML += `
                        <li class="flex py-2">
                            <img src="${item.img}" class="h-16 w-16 rounded-md object-cover border">
                            <div class="ml-4 flex-1 flex flex-col justify-center">
                                <div class="flex justify-between text-base font-medium text-gray-900">
                                    <h3>${item.name}</h3>
                                    <p class="ml-4">LKR ${item.price}</p>
                                </div>
                                <button onclick="removeFromCart(${idx})" class="text-sm text-red-500 hover:text-red-700 text-left mt-1">Remove</button>
                            </div>
                        </li>
                    `;
                });
            }
            
            totalEl.innerText = `LKR ${total.toFixed(2)}`;
            countEl.innerText = cart.length;
        }

        // 4. Checkout Logic (Connects to Python Backend)
        async function checkout() {
            if (cart.length === 0) return alert("Cart is empty!");

            const btn = document.getElementById('checkout-btn');
            const originalText = btn.innerHTML;
            
            // Loading State
            btn.disabled = true;
            btn.innerHTML = `<div class="loader"></div> Processing...`;
            btn.classList.add('opacity-75');

            const totalAmount = cart.reduce((sum, item) => sum + item.price, 0);

            try {
                // Send data to your Flask Backend
                const response = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ items: cart, total: totalAmount })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    // Create hidden form to Auto-Submit to PayHere
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = data.url;

                    for (const key in data.params) {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = data.params[key];
                        form.appendChild(input);
                    }
                    document.body.appendChild(form);
                    form.submit(); 
                } else {
                    alert('Error: ' + data.message);
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            } catch (err) {
                console.error(err);
                alert("Connection failed. Check your internet.");
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>